{% extends 'base.html' %}
{% load static %}

{% block title %}{{ video.title }} - Behind The Search{% endblock %}

{% block extra_css %}
<link href="https://vjs.zencdn.net/7.14.3/video-js.css" rel="stylesheet" />
<link rel="stylesheet" href="{% static 'css/videojs-theme.css' %}" />
<link rel="stylesheet" href="{% static 'css/content/video-details.css' %}" />
{% endblock %}

{% block content %}
<div class="video-detail-container">
  <div class="video-detail-header">
    <h1>{{ video.title }}</h1>
    <a href="{% url 'video_list' %}" class="back-button">
      <i class="fas fa-arrow-left"></i> Back to Video List
    </a>
  </div>

  <div class="video-detail-meta">
    <div class="video-detail-meta-item">
      <i class="fas fa-list-ol"></i>
      <span>Lesson {{ video.lesson_number }}</span>
    </div>
    <div class="video-detail-meta-item">
      <i class="{% if video.mark_as_watched %}fas fa-check-circle{% else %}far fa-circle{% endif %}"></i>
      <span>{% if video.mark_as_watched %}Completed{% else %}Not yet completed{% endif %}</span>
    </div>
  </div>

  <div class="video-detail-player-container">
    <video 
      id="course-video" 
      class="video-js vjs-theme-behind video-detail-player" 
      controls 
      preload="auto" 
      poster="{% static 'imgs/logo-trans.png' %}" 
      data-video-id="{{ video.id }}"
      data-setup='{
        "fluid": true,
        "playbackRates": [0.5, 0.75, 1, 1.25, 1.5, 1.75, 2]
      }'
      oncontextmenu="return false;"
    >
      <source src="{% url 'stream_video' video.id %}" type="video/mp4" />
      <p class="vjs-no-js">
        To view this video please enable JavaScript, and consider upgrading to a web browser that
        <a href="https://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a>
      </p>
    </video>
  </div>

  <div class="video-detail-content">
    <h2 class="video-detail-section-title">
      <span>Lesson Description</span>
      <button id="toggleDescription" class="toggle-button">
        <i class="fas fa-chevron-down"></i> Show More
      </button>
    </h2>
    <div id="descriptionContent" class="video-detail-description collapsed">
      {{ video.description|safe }}
    </div>
    
    <div class="video-detail-actions">
      <button id="markAsWatched" class="video-detail-mark-watched {% if video.mark_as_watched %}watched{% endif %}" data-video-id="{{ video.id }}">
        {% if video.mark_as_watched %}
          <i class="fas fa-check-circle"></i> Marked as Watched
        {% else %}
          <i class="far fa-circle"></i> Mark as Watched
        {% endif %}
      </button>
    </div>
  </div>

  <div class="video-detail-navigation">
    {% if prev_video %}
    <a href="{% url 'video_detail' prev_video.id %}" class="video-detail-nav-button prev">
      <i class="fas fa-arrow-left"></i> Previous Lesson
    </a>
    {% endif %}
    
    {% if next_video %}
    <a href="{% url 'video_detail' next_video.id %}" class="video-detail-nav-button next">
      Next Lesson <i class="fas fa-arrow-right"></i>
    </a>
    {% endif %}
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://vjs.zencdn.net/7.14.3/video.min.js"></script>
<script src="{% static 'js/content/video-details.js' %}"></script>
{% endblock %}
