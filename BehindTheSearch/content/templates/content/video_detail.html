{% extends 'base.html' %}
{% load static %}

{% block title %}
  {{ video.title }} - Behind The Search
{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/content/video-details.css' %}" />
{% endblock %}

{% block content %}
{% csrf_token %}
<div class="video-detail-container">
  <div class="video-detail-header">
    <h1>{{ video.title }}</h1>
    <a href="{% url 'section_detail' video.section.id %}" class="back-button">
      <i class="fas fa-arrow-left"></i> Back to Video List
    </a>
  </div>

  <div class="video-detail-meta">
    <div class="video-detail-meta-item">
      <i class="fas fa-list-ol"></i>
      <span>Lesson {{ video.lesson_number }}</span>
    </div>
    <div class="video-detail-meta-item">
      <i class="{% if video_is_watched_by_user %}fas fa-check-circle{% else %}far fa-circle{% endif %}"></i>
      <span>
        {% if video_is_watched_by_user %}
          Completed
        {% else %}
          Not yet completed
        {% endif %}
      </span>
    </div>
  </div>

  <div class="video-detail-player-container">
    {% if video.bunny_video_id %}
      <div class="bunny-video-wrapper" style="position: relative; padding-top: 56.25%">
        <iframe
          src="https://iframe.mediadelivery.net/embed/{{ video.bunny_library_id }}/{{ video.bunny_video_id }}?autoplay=false&loop=false&muted=false&preload=true&responsive=true"
          loading="lazy"
          style="border: 0; position: absolute; top: 0; height: 100%; width: 100%"
          allow="accelerometer;gyroscope;autoplay;encrypted-media;picture-in-picture;"
          allowfullscreen="true">
        </iframe>
      </div>
    {% else %}
      <div class="video-error-message">
        <p>No video available for this lesson.</p>
      </div>
    {% endif %}
  </div>

  <div class="video-detail-content">
    <h2 class="video-detail-section-title">
      <span>Lesson Description</span>
      <button id="toggleDescription" class="toggle-button">
        <i class="fas fa-chevron-down"></i> Show More
      </button>
    </h2>
    <div id="descriptionContent" class="video-detail-description collapsed">
      {{ video.description|safe }}
    </div>

    <div class="video-detail-actions">
      <button
        id="markAsWatched"
        class="video-detail-mark-watched {% if video_is_watched_by_user %}watched{% endif %}"
        data-video-id="{{ video.id }}">
        {% if video_is_watched_by_user %}
          <i class="fas fa-check-circle"></i> Marked as Watched
        {% else %}
          <i class="far fa-circle"></i> Mark as Watched
        {% endif %}
      </button>
    </div>
  </div>

  <div class="video-detail-navigation">
    {% if prev_video %}
      <a href="{% url 'video_detail' prev_video.id %}" class="video-detail-nav-button prev">
        <i class="fas fa-arrow-left"></i> Previous Lesson
      </a>
    {% endif %}
    
    {% if next_video %}
      <a href="{% url 'video_detail' next_video.id %}" class="video-detail-nav-button next">
        Next Lesson <i class="fas fa-arrow-right"></i>
      </a>
    {% endif %}
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/content/video-details.js' %}"></script>
{% endblock %}